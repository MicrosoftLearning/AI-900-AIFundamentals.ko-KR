---
lab:
  title: Azure ML에서 자동화된 Machine Learning 살펴보기
---

# Azure ML에서 자동화된 Machine Learning 살펴보기

> **참고** 이 랩을 완료하려면 관리 액세스 권한이 있는 [Azure 구독](https://azure.microsoft.com/free?azure-portal=true)이 필요합니다.

이번 연습에서는 이전 자전거 대여 세부 정보를 포함하는 데이터 세트를 사용하여 계절 및 기상 특성에 따라 지정된 날짜에 예상되는 자전거 대여 수를 예측하는 모델을 학습시킵니다.

## Azure Machine Learning 작업 영역 만들기  

1. Microsoft 자격 증명을 사용하여 [Azure Portal](https://portal.azure.com?azure-portal=true)에 로그인합니다.

1. **+ 리소스 만들기**를 선택하고, *Machine Learning*을 검색한 뒤 *Azure Machine Learning* 플랜을 사용하여 새 **Azure Machine Learning** 리소스를 만듭니다. 다음 설정을 사용합니다.
    - **구독**: *자신의 Azure 구독*.
    - **리소스 그룹**: 리소스 그룹 만들거나 선택하기
    - **작업 영역 이름**: 작업 영역의 고유한 이름 입력
    - **지역**: 지리적으로 가장 가까운 지역 선택
    - **스토리지 계정**: 작업 영역에 대해 만들 새로운 기본 스토리지 계정
    - **키 자격 증명 모음**: 작업 영역에 대해 만들 새로운 기본 키 자격 증명 모음
    - **Application insights**: 작업 영역에 대해 만들 새로운 기본 Application Insights 리소스
    - **컨테이너 레지스트리**: 없음(처음으로 컨테이너에 모델을 배포할 때 자동으로 만들어짐)

1. **검토 + 생성**를 선택한 다음, **생성**를 선택합니다. 작업 영역이 만들어질 때까지 기다린 다음(몇 분 정도 걸릴 수 있음) 배포된 리소스로 이동합니다.

1. **Studio 시작**을 선택하거나 또는 새 브라우저 탭을 열고 [https://ml.azure.com](https://ml.azure.com?azure-portal=true)로 이동한 다음, Microsoft 계정을 사용하여 Azure Machine Learning 스튜디오에 로그인합니다.

1. 표시되는 모든 메시지를 닫습니다.

1. Azure Machine Learning 스튜디오에서 새로 만든 작업 영역이 표시됩니다. 그렇지 않은 경우 왼쪽 메뉴에서 Azure 디렉터리를 선택합니다. 그런 다음 새 왼쪽 메뉴에서 디렉터리에 연결된 모든 **작업 영역**이 나열된 작업 영역을 선택하고 이 연습에 대해 만든 작업 영역을 선택합니다.

> **참고** 이 모듈은 [Microsoft Azure AI 기본 사항: 기계 학습을 위한 시각적 도구 살펴보기](https://docs.microsoft.com/learn/paths/create-no-code-predictive-models-azure-machine-learning/) 학습 경로의 다른 모듈을 포함하여 Azure Machine Learning 작업 영역을 활용하는 여러 모듈 중 하나입니다. 고유한 Azure 구독을 사용하는 경우 작업 영역을 만든 후 다른 모듈에서 다시 사용하는 것이 좋습니다. 사용자의 구독에 Azure Machine Learning 작업 영역이 존재하는 동안에는 Azure 구독에 약간의 데이터 스토리지 요금이 청구됩니다. 따라서 더 이상 필요하지 않은 경우 Azure Machine Learning 작업 영역을 삭제하는 것이 좋습니다.

## 컴퓨팅 만들기

1. [Azure Machine Learning 스튜디오](https://ml.azure.com?azure-portal=true) 왼쪽 위에 있는 **&#8801;** 아이콘(세 줄의 스택처럼 보이는 메뉴 아이콘)을 선택하여 인터페이스의 다양한 페이지를 봅니다(화면 크기를 최대화해야 할 수 있음). 왼쪽 창에서 해당 페이지를 사용하여 작업 영역에서 리소스를 관리할 수 있습니다. **컴퓨팅** 페이지(**관리** 아래)를 선택합니다.

1. **컴퓨팅** 페이지에서 **컴퓨팅 클러스터** 탭을 선택하고 다음 설정으로 새 컴퓨팅 클러스터를 추가합니다. 이를 사용하여 기계 학습 모델을 학습합니다.
    - **위치**: 작업 영역과 동일한 위치를 선택합니다. 해당 위치가 나열되어 있지 않으면 가장 가까운 위치를 선택합니다.
    - **가상 머신 계층**: 전용
    - **가상 머신 유형**: CPU
    - **가상 머신 크기**:
        - **모든 옵션에서 선택** 선택
        - **Standard_DS11_v2**를 검색하고 선택
    - **다음**을 선택합니다.
    - **컴퓨팅 이름**: 고유한 이름 입력
    - **최소 노드 수**: 0
    - **최대 노드 수**: 2
    - **스케일 다운 전 유휴 시간(초)**: 120
    - **SSH 액세스 사용**: 사용하도록 설정 안 함
    - **만들기**를 선택합니다.

> **참고**: 컴퓨팅 인스턴스 및 클러스터는 표준 Azure 가상 머신 이미지를 기반으로 합니다. 이 모듈에서는 비용 및 성능의 최적 균형을 달성하기 위해 *Standard_DS11_v2* 이미지를 권장합니다. 구독에 이 이미지를 포함하지 않는 할당량이 있는 경우 다른 이미지를 선택하세요. 하지만 이미지가 클수록 비용이 더 많이 들 수 있고 더 작은 이미지는 작업을 완료하기에 충분하지 않을 수 있습니다. 또는 Azure 관리자에게 할당량을 확장하도록 요청하세요.

컴퓨팅 클러스터는 만들어지는 데 시간이 좀 걸립니다. 대기하는 동안 다음 단계로 이동할 수 있습니다.

## 데이터 자산 만들기

1. 웹 브라우저에서 [https://aka.ms/bike-rentals](https://aka.ms/bike-rentals?azure-portal=true)에 접속해 쉼표로 구분된 데이터를 확인합니다.

1. [Azure Machine Learning 스튜디오](https://ml.azure.com?azure-portal=true) 화면 왼쪽 위에 있는 메뉴 아이콘을 선택하여 왼쪽 창을 확장합니다. **데이터** 페이지(**자산** 아래)를 봅니다. 데이터 페이지에는 Azure ML에서 사용할 특정 데이터 파일 또는 테이블이 있습니다. 이 페이지에서도 데이터 세트를 만들 수 있습니다.

1. **데이터** 페이지의 **데이터 자산** 탭에서 **만들기**를 선택합니다. 그런 다음, 다음 설정을 사용하여 데이터 자산을 구성합니다.
    * **데이터 형식**:
        * **이름**: bike-rentals
        * **설명**: 자전거 대여 데이터
        * **데이터 세트 형식**: 테이블 형식
    * **데이터 원본**: 웹 파일에서
    * **웹 URL**: 
        * **웹 URL**: [https://aka.ms/bike-rentals](https://aka.ms/bike-rentals?azure-portal=true)
        * **데이터 유효성 검사 건너뛰기**: ‘선택하지 않습니다’.
    * **설정**:
        * **파일 형식**: 구분 기호로 분리됨
        * **구분 기호**: 쉼표
        * **인코딩**: UTF-8
        * **열 헤더**: 첫 번째 파일에만 헤더가 있음
        * **행 건너뛰기**: 없음
        * **데이터 세트에 여러 줄 데이터가 포함되어 있음**: 선택하지 마세요.
    * **스키마**:
        * **경로** 이외의 모든 열 포함
        * 자동으로 검색된 형식 검토
    * **검토**
        * **만들기**를 선택합니다.

1. 데이터 세트를 만든 후에는 이를 열고 **탐색** 페이지를 보면서 데이터 샘플을 확인합니다. 이 데이터에는 자전거 대여에 대한 이전 특징 및 레이블이 포함되어 있습니다.

> **인용**: 이 데이터는 [Capital Bikeshare](https://www.capitalbikeshare.com/system-data)에서 파생되었으며 게시된 데이터 [사용권 계약](https://www.capitalbikeshare.com/data-license-agreement)에 따라 사용됩니다.

## 자동화된 Machine Learning 작업을 실행합니다.

자동화된 기계 학습을 사용하여 자전거 대여를 예측하는 회귀 모델을 학습시키는 작업을 실행하는 다음 단계를 수행합니다.

1. [Azure Machine Learning 스튜디오](https://ml.azure.com?azure-portal=true) **자동화된 ML** 페이지(작성 아래)**를 봅니다**.

1. 다음 설정을 사용하여 자동화된 ML 작업을 만듭니다.
    - **데이터 자산 선택**:
        - **데이터 세트**: bike-rentals
    - **작업 구성**:
        - **새 실험 이름**: mslearn-bike-rental
        - **대상 열**: rentals(‘모델이 예측하도록 학습되는 레이블’)
        - **Azure ML 컴퓨팅 클러스터 선택**: 이전에 만든 컴퓨팅 클러스터
    - **태스크 및 설정을 선택합니다.** 
        - **작업 유형**: 회귀(‘모델이 숫자 값 예측’) 

    ![회귀 작업 유형 및 추가 구성 설정 주위에 상자가 있는 선택 창의 스크린샷](media/use-automated-machine-learning/new-automated-ml-run-4.png)

    작업 유형 아래에 추가 구성 설정 보기 및 기능화 설정 보기 설정이 표시됩니다.  이제 다음 설정을 구성합니다.

    - **추가 구성 설정:**
        - **기본 메트릭**: **정규화된 제곱 평균 오차**를 선택합니다.
        - **최적 모델 설명**: 선택함 - ‘이 옵션을 선택하면 자동화된 기계 학습이 최적 모델의 기능 중요도를 계산합니다. 기능 중요도를 통해 각 기능이 예측 레이블에 미치는 영향을 확인할 수 있습니다.’
        - **지원되는 모든 모델 사용**: <u>선택 취소</u>합니다. 몇 가지 특정 알고리즘만 시도하도록 작업을 제한합니다.
        - **허용되는 모델**: **RandomForest** 및 **LightGBM**만 선택합니다. 일반적으로 가능한 한 많이 시도하려고 하지만 추가한 모델만큼 실험을 실행하는 데 걸리는 시간이 늘어납니다.

        ![허용되는 모델 주위에 상자가 있는 추가 구성의 스크린샷](media/use-automated-machine-learning/allowed-models.png)
        - **종료 기준**:
            - **학습 작업 시간(시간)** : 0.5 - 최대 30분 후에 작업을 종료합니다.
            - **메트릭 점수 임계값**: 0.085 - 모델이 정규화된 제곱 평균 오차 메트릭 점수인 0.085 이하에 도달하면 작업이 종료됩니다.
        - **동시성**: ‘변경하지 않습니다.’
    - **기능화 설정:**
        - **기능화 사용**: 선택함 - ‘학습 전에 기능을 자동으로 전처리합니다.’

    **다음**을 클릭하여 다음 선택 창으로 이동합니다.

    - **유효성 검사 및 테스트 유형 선택**
        - **유효성 검사 유형**: 자동
        - **테스트 데이터 자산(미리 보기)** : 테스트 데이터 자산이 필요하지 않음

1. 자동화된 Machine Learning 작업 세부 정보 제출을 완료하면 자동으로 시작됩니다. 상태가 준비 중에서 실행 중으로 변경될 때까지 기다립니다. 

1. 상태가 실행 중으로 변경되면 **모델** 탭에서 학습 알고리즘과 전처리 단계의 가능한 각 조합이 시도되고 결과 모델의 성능이 평가되는지 관측합니다. 주기적으로 페이지가 자동으로 새로 고쳐지지만 **새로 고침**을 선택할 수도 있습니다. 클러스터 노드를 초기화해야 학습을 시작할 수 있으므로 모델이 표시되는 데 10분 정도 걸릴 수 있습니다.

1. 작업이 완료될 때까지 기다립니다. 시간이 걸릴 수도 있으므로 지금은 잠깐 쉬는 것이 좋을 수 있습니다.

## 최적 모델 검토

1. 자동화된 기계 학습 작업의 **개요** 탭에서 최적 모델 요약을 확인합니다.
    ![알고리즘 이름 주위에 상자가 있는 자동화된 기계 학습 작업의 최상의 모델 요약의 스크린샷](media/use-automated-machine-learning/complete-run.png)

    > **참고** "경고: 사용자가 지정한 종료 점수에 도달했습니다..."상태 메시지가 표시될 수 있습니다. 정상적인 메시지입니다. 다음 단계를 계속 진행하세요.  
1. 최적 모델의 **알고리즘 이름** 아래의 텍스트를 선택하여 세부 정보를 확인합니다.

1. *정규화된 제곱 평균 오차* 값 옆에 있는 **다른 모든 메트릭 보기**를 선택하여 회귀 모델에 대한 가능한 다른 평가 메트릭 값을 확인합니다.

    ![모델 탭에서 다른 모든 메트릭 보기를 찾는 방법의 스크린샷](media/use-automated-machine-learning/review-run-1.png)

1. **메트릭** 탭을 선택하고 **잔차** 및 **predicted_true** 차트를 아직 선택하지 않은 경우 선택합니다. 
    ![잔차 및 predicted_true 차트가 선택된 메트릭 탭의 스크린샷](media/use-automated-machine-learning/review-run-3.png)

    모델의 성능을 보여 주는 차트를 검토합니다. 첫 번째 차트는 예측 값과 실제 값의 차이인 잔차를 히스토그램으로 표시하고 두 번째 차트는 예측 값과 실제 값을 비교합니다.

1. **설명** 탭을 선택합니다. 설명 ID를 선택한 다음, **집계 기능 중요도**를 선택합니다. 이 차트는 다음과 같이 데이터 세트의 각 기능이 레이블 예측에 영향을 미치는 정도를 보여 줍니다.

    ![설명 탭의 기능 중요도 차트의 스크린샷](media/use-automated-machine-learning/feature-importance.png)

## 예측 서비스 배포

1. [Azure Machine Learning Studio](https://ml.azure.com?azure-portal=true)의 **자동화된 ML** 페이지에서 자동화된 기계 학습 작업을 선택합니다.

1. **개요** 탭에서 최상의 모델에 대한 알고리즘 이름을 선택합니다.

    ![세부 정보 탭의 알고리즘 이름 주위에 상자가 있는 최상의 모델 요약의 스크린샷](media/use-automated-machine-learning/deploy-detail-tab.png)

1. **모델** 탭에서 **배포** 단추를 선택하고 **웹 서비스에 배포** 옵션을 사용하여 다음 설정으로 모델을 배포합니다.
    - **이름**: predict-rentals
    - **설명**: 자전거 대여 예측
    - **컴퓨팅 형식**: Azure Container Instances
    - **인증 사용**: 선택됨

1. 배포가 시작될 때까지 대기합니다. 이 작업에는 몇 초 정도 걸릴 수 있습니다. 그런 다음, **모델 요약** 섹션에서 **predict-rentals** 서비스에 대한 **배포 상태**를 확인합니다. 이 상태는 **실행 중**이어야 합니다. 이 상태가 **성공**으로 변경될 때까지 기다립니다. 시간이 좀 걸릴 수 있습니다. 주기적으로 **새로 고침**을 선택해야 할 수도 있습니다.

1. Azure Machine Learning 스튜디오의 왼쪽 메뉴에서 **엔드포인트**를 선택합니다.
    ![왼쪽 메뉴의 엔드포인트 위치 스크린샷](media/use-automated-machine-learning/find-endpoints.png)

## 배포된 서비스 테스트

이제 배포된 서비스를 테스트할 수 있습니다.

1. **엔드포인트** 페이지에서 **predict-rentals** 실시간 엔드포인트를 엽니다.

1. **predict-rentals** 엔드포인트가 열리면 **테스트** 탭을 확인합니다.

1. **실시간 엔드포인트를 테스트할 입력 데이터** 창에서 템플릿 JSON을 다음 입력 데이터로 바꿉니다.

    ```JSON
    {
      "Inputs": { 
        "data": [
          {
            "day": 1,
            "mnth": 1,   
            "year": 2022,
            "season": 2,
            "holiday": 0,
            "weekday": 1,
            "workingday": 1,
            "weathersit": 2, 
            "temp": 0.3, 
            "atemp": 0.3,
            "hum": 0.3,
            "windspeed": 0.3 
          }
        ]    
      },   
      "GlobalParameters": 1.0
    }
    ```

1. **테스트** 단추를 클릭합니다.

1. 입력 기능에 따라 예측된 대여 수를 포함하는 테스트 결과를 검토합니다. 테스트 창에서는 입력 데이터를 사용하고 예측된 대여 수를 반환하도록 학습한 모델을 사용했습니다.

    ![테스트 탭에서 샘플 데이터를 사용하여 모델을 테스트하는 예제의 스크린샷](media/use-automated-machine-learning/workaround-test.png)

수행한 작업을 검토해 보겠습니다. 이전 자전거 대여 데이터의 데이터 세트를 사용하여 모델을 학습시켰습니다. 이 모델은 계절 및 기상 *특성*을 기준으로 지정된 날에 예상되는 자전거 대여 수를 예측합니다. 이 경우 *레이블*은 자전거 대여 수입니다.

**사용** 탭의 자격 증명을 사용하여 클라이언트 애플리케이션에 연결할 준비가 된 서비스를 방금 테스트했습니다. 여기서 랩을 종료합니다. 방금 배포한 서비스를 계속 실험해 볼 수 있습니다.

## 정리

만든 웹 서비스는 *Azure Container Instance*에 호스트됩니다. 추가 실험 의사가 없는 경우 불필요한 Azure 사용이 발생하지 않도록 엔드포인트를 삭제해야 합니다. 컴퓨팅 클러스터도 삭제해야 합니다.

1. [Azure Machine Learning Studio](https://ml.azure.com?azure-portal=true)의 **엔드포인트** 탭에서 **predict-rentals** 엔드포인트를 선택합니다. 그런 다음, **삭제**를 선택하고 엔드포인트를 삭제하겠다고 확인합니다.
2. **컴퓨팅** 페이지의 **컴퓨팅 클러스터** 탭에서 컴퓨팅 instance 선택한 다음 **삭제**를 선택합니다.

> **참고** 컴퓨팅을 삭제하면 컴퓨팅 리소스에 대한 구독 요금이 청구되지 않습니다. 그러나 구독에 Azure Machine Learning 작업 영역이 존재하는 동안에는 약간의 데이터 스토리지 요금이 청구됩니다. Azure Machine Learning 탐색을 완료했으면 Azure Machine Learning 작업 영역 및 관련 리소스를 삭제할 수 있습니다. 그러나 이 시리즈의 다른 랩을 완료하려는 경우에는 다시 만들어야 합니다.
>
> 작업 영역을 삭제하려면,
> 1. [Azure Portal](https://portal.azure.com?azure-portal=true)의 **리소스 그룹** 페이지에서 Azure Machine Learning 작업 영역을 만들 때 지정한 리소스 그룹을 엽니다.
> 2. **리소스 그룹 삭제**를 클릭하고 삭제하고자 하는 리소스 그룹 이름을 입력한 다음 **삭제**를 선택합니다.
